<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Suis-je gay ?</title>
  <style>
    :root {
      --bg: #0b0f19;
      --panel: rgba(255,255,255,0.06);
      --text: #e8ecf7;
      --muted: rgba(232,236,247,0.72);
      --accent: #7c5cff;
      --shadow: 0 18px 45px rgba(0,0,0,0.45);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      background: radial-gradient(1200px 600px at 20% 10%, rgba(124,92,255,0.25), transparent 55%),
                  radial-gradient(900px 500px at 85% 80%, rgba(255,92,165,0.18), transparent 55%),
                  var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      padding: 24px;
    }
    .card {
      width: min(860px, 96vw);
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.09);
      border-radius: 24px;
      box-shadow: var(--shadow);
      padding: 22px;
      display: grid;
      gap: 18px;
    }
    header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 44px);
      letter-spacing: -0.02em;
    }
    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }
    .layout {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 18px;
      align-items: center;
    }
    @media (max-width: 780px) {
      .layout { grid-template-columns: 1fr; }
    }

    .wheel-wrap {
      display: grid;
      place-items: center;
      padding: 14px;
      border-radius: 18px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.08);
      position: relative;
    }

    /* Pointeur */
    .pointer {
      position: absolute;
      top: 8px;
      z-index: 3;
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 26px solid rgba(255,255,255,0.92);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.35));
    }

    canvas {
      width: min(520px, 86vw);
      height: auto;
      aspect-ratio: 1/1;
      display: block;
      border-radius: 999px;
      background: rgba(255,255,255,0.02);
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
    }

    .controls {
      padding: 14px;
      border-radius: 18px;
      background: rgba(0,0,0,0.18);
      border: 1px solid rgba(255,255,255,0.08);
      display: grid;
      gap: 12px;
      align-content: start;
    }

    button {
      appearance: none;
      border: 0;
      border-radius: 16px;
      padding: 14px 16px;
      cursor: pointer;
      font-weight: 700;
      font-size: 16px;
      color: white;
      background: linear-gradient(135deg, var(--accent), #ff5ca5);
      box-shadow: 0 14px 26px rgba(124,92,255,0.22), 0 10px 22px rgba(255,92,165,0.15);
      transition: transform .08s ease, filter .2s ease, opacity .2s ease;
    }
    button:active { transform: translateY(1px) scale(0.99); }
    button:disabled { opacity: 0.55; cursor: not-allowed; filter: saturate(0.7); }

    .result {
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.04);
      min-height: 66px;
      display: grid;
      gap: 6px;
      align-content: center;
    }
    .result .label {
      font-size: 12px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .result .value {
      font-size: 22px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }

    .note {
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    code.inline {
      padding: 0 8px;
      border-radius: 8px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.10);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <main class="card">
    <header>
      <h1>Suis-je gay&nbsp;?</h1>
      <p class="subtitle">Une roue “30 NON / 5 OUI”… avec un destin écrit d’avance.</p>
    </header>

    <section class="layout">
      <div class="wheel-wrap">
        <div class="pointer" aria-hidden="true"></div>
        <canvas id="wheel" width="900" height="900" aria-label="Roue de la chance"></canvas>
      </div>

      <div class="controls">
        <button id="spinBtn">Lancer la roue</button>

        <div class="result" aria-live="polite">
          <div class="label">Résultat</div>
          <div class="value" id="resultValue">—</div>
        </div>

        <div class="note">
          Répartition affichée : <b>30</b> “NON” et <b>5</b> “OUI”.<br/>
          Répartition réelle : <span class="inline code">100% OUI</span> (parce que c’est le gag).
        </div>
      </div>
    </section>
  </main>

  <script>
    // --- Données de la roue ---
    const NON = 30;
    const OUI = 5;
    const slices = [
      ...Array(NON).fill("NON"),
      ...Array(OUI).fill("OUI")
    ];

    // Mélange visuel optionnel (la roue affiche bien 30/5, dans un ordre random)
    // Note: le résultat final sera TOUJOURS "OUI" via le ciblage d'angle.
    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    const displaySlices = shuffle(slices);

    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const resultValue = document.getElementById("resultValue");

    const N = displaySlices.length;
    const TAU = Math.PI * 2;
    const sliceAngle = TAU / N;

    // Angle actuel (en radians). On fait tourner le canvas.
    let currentAngle = 0;
    let spinning = false;

    // --- Dessin ---
    function drawWheel(angle = 0) {
      const w = canvas.width;
      const h = canvas.height;
      const cx = w / 2, cy = h / 2;
      const r = Math.min(w, h) * 0.46;

      ctx.clearRect(0, 0, w, h);

      // Fond doux
      ctx.beginPath();
      ctx.arc(cx, cy, r + 26, 0, TAU);
      ctx.fillStyle = "rgba(255,255,255,0.04)";
      ctx.fill();

      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(angle);

      for (let i = 0; i < N; i++) {
        const start = i * sliceAngle;
        const end = start + sliceAngle;

        // Couleurs: NON (bleuté), OUI (rosé). Alternance légère pour le relief.
        const label = displaySlices[i];
        const isOui = label === "OUI";
        const alt = i % 2 === 0 ? 0.10 : 0.18;

        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.arc(0, 0, r, start, end);
        ctx.closePath();

        ctx.fillStyle = isOui
          ? `rgba(255,92,165,${0.55 + alt})`
          : `rgba(124,92,255,${0.50 + alt})`;
        ctx.fill();

        // Séparateurs
        ctx.strokeStyle = "rgba(255,255,255,0.16)";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Texte
        ctx.save();
        ctx.rotate(start + sliceAngle / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "rgba(255,255,255,0.94)";
        ctx.font = "900 30px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
        ctx.shadowColor = "rgba(0,0,0,0.35)";
        ctx.shadowBlur = 8;
        ctx.fillText(label, r - 18, 10);
        ctx.restore();
      }

      // Centre
      ctx.beginPath();
      ctx.arc(0, 0, r * 0.18, 0, TAU);
      ctx.fillStyle = "rgba(0,0,0,0.32)";
      ctx.fill();
      ctx.strokeStyle = "rgba(255,255,255,0.22)";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.fillStyle = "rgba(255,255,255,0.92)";
      ctx.font = "900 26px ui-sans-serif, system-ui";
      ctx.textAlign = "center";
      ctx.fillText("SPIN", 0, 9);

      ctx.restore();
    }

    // Quel index est sous le pointeur (en haut), selon l'angle actuel ?
    // Pointeur en haut = angle global qui correspond à -90° (ou 3π/2).
    function indexAtPointer(angle) {
      // On veut l’angle “vue” au pointeur, en coordonnées roue.
      const pointerAngle = -Math.PI / 2;
      // L'angle de la roue étant "angle", un point fixe (pointeur) correspond à -angle dans le repère roue.
      const a = (pointerAngle - angle) % TAU;
      const norm = (a + TAU) % TAU;
      const idx = Math.floor(norm / sliceAngle);
      return idx;
    }

    // --- Trucage: viser une case OUI, toujours ---
    function pickOuiIndex() {
      const ouiIndices = [];
      for (let i = 0; i < N; i++) if (displaySlices[i] === "OUI") ouiIndices.push(i);
      // Choisir un des OUI au hasard (mais toujours un OUI)
      return ouiIndices[Math.floor(Math.random() * ouiIndices.length)];
    }

    // Calcule un angle final qui place l'index ciblé sous le pointeur.
    // Ajoute aussi un petit "offset" aléatoire à l'intérieur de la case pour éviter un rendu trop robot.
    function angleToLandOnIndex(targetIndex) {
      const pointerAngle = -Math.PI / 2;

      // On veut que indexAtPointer(finalAngle) == targetIndex.
      // Ce qui revient à aligner le centre de la tranche target sous le pointeur.
      const centerOfSlice = targetIndex * sliceAngle + sliceAngle / 2;

      // pointerAngle - finalAngle ≈ centerOfSlice  (mod TAU)
      // => finalAngle ≈ pointerAngle - centerOfSlice (mod TAU)
      let base = pointerAngle - centerOfSlice;

      // Petit jitter dans la tranche (± 30% de la demi-tranche)
      const jitter = (Math.random() - 0.5) * sliceAngle * 0.6;
      base -= jitter;

      // Normaliser
      base = ((base % TAU) + TAU) % TAU;
      return base;
    }

    // Animation: spin très rapide, puis décélération.
    function animateSpin(finalAngle) {
      const duration = 3400; // ms
      const start = performance.now();
      const startAngle = currentAngle;

      // Tours supplémentaires pour l'effet "très vite"
      const extraTurns = 10 + Math.floor(Math.random() * 6); // 10 à 15 tours
      const target = finalAngle + extraTurns * TAU;

      function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

      function frame(now) {
        const t = Math.min(1, (now - start) / duration);
        const eased = easeOutCubic(t);

        currentAngle = startAngle + (target - startAngle) * eased;
        drawWheel(currentAngle);

        if (t < 1) {
          requestAnimationFrame(frame);
        } else {
          // Caler précisément
          currentAngle = finalAngle;
          drawWheel(currentAngle);

          const idx = indexAtPointer(currentAngle);
          const label = displaySlices[idx];
          resultValue.textContent = label;
          spinning = false;
          spinBtn.disabled = false;
        }
      }

      requestAnimationFrame(frame);
    }

    // Init
    drawWheel(currentAngle);

    spinBtn.addEventListener("click", () => {
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      resultValue.textContent = "…";

      // Toujours tomber sur OUI :
      const targetOui = pickOuiIndex();
      const finalAngle = angleToLandOnIndex(targetOui);

      animateSpin(finalAngle);
    });
  </script>
</body>
</html>
